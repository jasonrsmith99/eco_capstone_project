---
title: "average wage select counties"
output: github_document
---


```{r, message=FALSE}
library(tidyverse)
```

```{r}
load(here::here("data", "acs2019.RData"))
```

joining fips codes into one code so we can use the codes given by fact finder
```{r}
counties <- acs2019 %>% 
  unite("state_county", statefip, countyfip, sep = "", na.rm = TRUE, remove = FALSE)
```

filtering counties of interest
```{r}
counties <- counties %>% 
  filter(state_county %in% c(2681, 39153, 183, 1743, 5525))

counties$state_county <- factor(counties$state_county, labels = c("Dupage", "Allen", "Kent", "Summit", "Dane"))

counties <- counties %>% 
  rename(county = state_county)
```

summary table. The data is so skewed right this probably isn't very useful. Maybe do weighted median?
```{r}
counties %>% 
  group_by(county) %>% 
  summarize(mean_wage = weighted.mean(incwage, perwt), n = n()) %>% 
  knitr::kable()
```

graphing
```{r}
#when am I supposed to use weights
counties %>% 
  ggplot(aes(x = incwage))+
  geom_boxplot(aes(weight = perwt, color = county))+
  labs(x = "Income",
       color = "County",
       title = "Income by county",
       subtitle = "weighted?")+
  scale_x_continuous(labels = scales::dollar,
                     expand = expansion(mult = c(.01, .06)))+
  ggpubr::theme_pubr()+
  theme(axis.ticks.y = element_blank(),
        axis.text.y = element_blank())
```

ANOVA to see if there is a significant difference between the counties
```{r}
anova <- aov(incwage ~ county, weights = perwt, data = counties)
summary(anova)
```
We conclude from the ANOVA that there is a significant difference in earnings between the counties. We can use Tukey to find out which differences specifically are different.
```{r}
TukeyHSD(anova)

```
The significant differences are

- Summit and Dupage
- Summit and Allen
- Dane and Allen
- Summit and Kent

Looking closely at the Tukey output, the outliers are really skewing the results. It may be beneficial to either remove outliers or look only within IQR.

The cities may also not have been chosen well to be compared to Kent County (which is what we're really interested in)



## Two-way anova with county and educ

I have no idea if this is valid or not

```{r}
county_2 <- counties

county_2 <- county_2 %>% 
  mutate(highest_deg = case_when(educd < 62 ~ "Less than HS",
                                 educd < 81 ~ "High School",
                                 educd < 101 ~ "Associates",
                                 educd < 114 ~ "Bachelors",
                                 TRUE ~ "Grad")) #will need to reconsider these blocks

county_2$highest_deg <- factor(county_2$highest_deg)

anova2 <- aov(incwage ~ highest_deg, weights = perwt, data = county_2)
summary(anova2)
```

```{r}
TukeyHSD(anova2)
```
All differences are significant except for high school and associates degrees. This may be due to poor model specification.

It may be better yet to do some interaction model
```{r}
anova3 <- aov(incwage ~ county * highest_deg, weights = perwt, data = county_2)
summary(anova3)
```

```{r}
TukeyHSD(anova3)
```
and I really have no idea where to begin with this output -_-
